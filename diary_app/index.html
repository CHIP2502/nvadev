<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nhật ký</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>📔 Nhật ký cá nhân</h1>

  <!-- Form đăng nhập -->
  <div id="login-section">
    <h2>Đăng nhập</h2>
    <input id="username" placeholder="Tên đăng nhập">
    <input id="password" type="password" placeholder="Mật khẩu">
    <button onclick="login()">Đăng nhập</button>
    <p id="login-msg"></p>
  </div>

  <!-- Form viết nhật ký -->
  <div id="diary-section" style="display:none;">
    <h2>✍️ Viết nhật ký</h2>
    <input id="title" placeholder="Tiêu đề">
    <input id="emotion" placeholder="Cảm xúc (😊😢😡)">
    <input id="date" type="datetime-local">
    <textarea id="content" placeholder="Nội dung..."></textarea><br>
    <label><input type="checkbox" id="isPublic"> Đăng công khai</label><br>
    <button onclick="saveEntry()">Lưu nhật ký</button>
    <p id="save-msg"></p>

    <hr>
    <h2>📖 Nhật ký của tôi</h2>
    <div id="my-entries"></div>

    <hr>
    <a href="public.html">📢 Xem nhật ký công khai</a>
  </div>

  <script>
    const users = [
      {username: "user1", password: "123"},
      {username: "user2", password: "456"}
    ];
    let currentUser = null;

    function login(){
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      const valid = users.find(x => x.username===u && x.password===p);
      if(valid){
        currentUser = u;
        document.getElementById("login-section").style.display="none";
        document.getElementById("diary-section").style.display="block";
        loadMyEntries();
      } else {
        document.getElementById("login-msg").innerText="❌ Sai tài khoản hoặc mật khẩu!";
      }
    }

    function saveEntry(){
      if(!currentUser) return;
      const entry = {
        user: currentUser,
        title: document.getElementById("title").value,
        emotion: document.getElementById("emotion").value,
        date: document.getElementById("date").value,
        content: document.getElementById("content").value,
        isPublic: document.getElementById("isPublic").checked
      };
      let entries = JSON.parse(localStorage.getItem("diaryEntries")||"[]");
      entries.push(entry);
      localStorage.setItem("diaryEntries", JSON.stringify(entries));
      document.getElementById("save-msg").innerText="✅ Đã lưu!";
      loadMyEntries();
    }

    function loadMyEntries(){
      let entries = JSON.parse(localStorage.getItem("diaryEntries")||"[]");
      let myEntries = entries.filter(e => e.user === currentUser);
      const container = document.getElementById("my-entries");
      container.innerHTML="";
      if(myEntries.length===0){
        container.innerHTML="<p>Chưa có nhật ký nào.</p>";
        return;
      }
      myEntries.forEach(e=>{
        const div=document.createElement("div");
        div.className="entry";
        div.innerHTML=`
          <h3>${e.title} (${e.emotion})</h3>
          <p><b>Ngày:</b> ${e.date}</p>
          <p>${e.content}</p>
          <small>${e.isPublic?"🌍 Công khai":"🔒 Riêng tư"}</small>
        `;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
